<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="EBrmap">
<title>EB-rMAP Prior with a Normal Endpoint • EBrmap</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="EB-rMAP Prior with a Normal Endpoint">
<meta property="og:description" content="EBrmap">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">EBrmap</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/TTE.html">EB-rMAP Prior with a Time-to-Event Endpoint</a>
    <a class="dropdown-item" href="../articles/normal.html">EB-rMAP Prior with a Normal Endpoint</a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav"></ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>EB-rMAP Prior with a Normal Endpoint</h1>
                        <h4 data-toc-skip class="author">Hongtao
Zhang</h4>
            
            <h4 data-toc-skip class="date">12/15/2022</h4>
      
      
      <div class="d-none name"><code>normal.Rmd</code></div>
    </div>

    
    
<p>We demonstrate the usage of EB-rMAP when a normal endpoint is
considered. The standard deviation of the endpoint is assumed known
throughout the case study.</p>
<div class="section level2">
<h2 id="historical-data-and-the-map-prior">Historical Data and the MAP Prior<a class="anchor" aria-label="anchor" href="#historical-data-and-the-map-prior"></a>
</h2>
<p>The historical data to construct the MAP prior are from dataset
<em><code>crohn</code></em> in <em>RBesT</em> package [1]. The data
contain six historical trials in moderate to severe Crohn’s disease. The
normal endpoint is the change from baseline in Crohn’s Disease Activity
Index (CDAI) at week 6, for which a smaller negative value indicates a
better response. The common standard deviation of the endpoint <span class="math inline">\(\sigma\)</span> is fixed at 88. A random effect
meta-analysis yields a point estimate of -50 for the mean response, with
95% confidence interval (-61.7, -38.1).</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://opensource.nibr.com/RBesT/" class="external-link">RBesT</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org" class="external-link">tidyverse</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://squallteo.github.io/EBrmap/">EBrmap</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">dt</span> <span class="op">&lt;-</span> <span class="fu">RBesT</span><span class="fu">::</span><span class="va"><a href="https://opensource.nibr.com/RBesT/reference/crohn.html" class="external-link">crohn</a></span></span>
<span><span class="va">sigma</span> <span class="op">&lt;-</span> <span class="fl">88</span></span>
<span><span class="va">dt</span><span class="op">$</span><span class="va">se_yh</span> <span class="op">&lt;-</span> <span class="va">sigma</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="va">dt</span><span class="op">$</span><span class="va">n</span><span class="op">)</span></span>
<span><span class="fu">kableExtra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="va">dt</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<thead><tr>
<th style="text-align:left;">
study
</th>
<th style="text-align:right;">
n
</th>
<th style="text-align:right;">
y
</th>
<th style="text-align:right;">
se_yh
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:left;">
Gastr06
</td>
<td style="text-align:right;">
74
</td>
<td style="text-align:right;">
-51
</td>
<td style="text-align:right;">
10.229792
</td>
</tr>
<tr>
<td style="text-align:left;">
AIMed07
</td>
<td style="text-align:right;">
166
</td>
<td style="text-align:right;">
-49
</td>
<td style="text-align:right;">
6.830125
</td>
</tr>
<tr>
<td style="text-align:left;">
NEJM07
</td>
<td style="text-align:right;">
328
</td>
<td style="text-align:right;">
-36
</td>
<td style="text-align:right;">
4.858987
</td>
</tr>
<tr>
<td style="text-align:left;">
Gastr01a
</td>
<td style="text-align:right;">
20
</td>
<td style="text-align:right;">
-47
</td>
<td style="text-align:right;">
19.677398
</td>
</tr>
<tr>
<td style="text-align:left;">
APhTh04
</td>
<td style="text-align:right;">
25
</td>
<td style="text-align:right;">
-90
</td>
<td style="text-align:right;">
17.600000
</td>
</tr>
<tr>
<td style="text-align:left;">
Gastr01b
</td>
<td style="text-align:right;">
58
</td>
<td style="text-align:right;">
-54
</td>
<td style="text-align:right;">
11.554966
</td>
</tr>
</tbody>
</table>
<p>The MAP prior is derived using the <em><code><a href="https://opensource.nibr.com/RBesT/reference/gMAP.html" class="external-link">RBesT::gMAP</a></code></em>
command, which is subsequently approximated by a mixture of three
conjugate normal distributions with
<em><code><a href="https://opensource.nibr.com/RBesT/reference/automixfit.html" class="external-link">RBesT::automixfit</a></code></em> command.</p>
<p>The vauge prior to construct the robust MAP prior is a normal
distribution with mean -50 and effective sample size of 1. This can be
specified using the <code>mn</code> parameterization in
<em><code><a href="https://opensource.nibr.com/RBesT/reference/mixnorm.html" class="external-link">RBesT::mixnorm</a></code></em>. Note that the hyper-parameters are
automatically converted to <code>ms</code> parameterization
corresponding to mean and standard deviation.</p>
<p>For detailed specifications, refer to Section 3.1 of Zhang et
al. [2]</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">712</span><span class="op">)</span></span>
<span><span class="va">map_mcmc</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://opensource.nibr.com/RBesT/reference/gMAP.html" class="external-link">gMAP</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">y</span>, <span class="va">se_yh</span><span class="op">)</span> <span class="op">~</span> <span class="fl">1</span> <span class="op">|</span> <span class="va">study</span>,</span>
<span>                 weight <span class="op">=</span> <span class="va">n</span>,</span>
<span>                 data<span class="op">=</span><span class="va">dt</span>,</span>
<span>                 family<span class="op">=</span><span class="va">gaussian</span>,</span>
<span>                 beta.prior<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="fl">0</span>, <span class="va">sigma</span><span class="op">)</span>,</span>
<span>                 tau.dist<span class="op">=</span><span class="st">"HalfNormal"</span>,tau.prior<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="fl">0</span>,<span class="va">sigma</span><span class="op">/</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">map_hat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://opensource.nibr.com/RBesT/reference/automixfit.html" class="external-link">automixfit</a></span><span class="op">(</span><span class="va">map_mcmc</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/sigma.html" class="external-link">sigma</a></span><span class="op">(</span><span class="va">map_hat</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">sigma</span></span>
<span></span>
<span><span class="va">vague_prior</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://opensource.nibr.com/RBesT/reference/mixnorm.html" class="external-link">mixnorm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="op">-</span><span class="fl">50</span>, <span class="fl">1</span><span class="op">)</span>, sigma<span class="op">=</span><span class="va">sigma</span>, param<span class="op">=</span><span class="st">"mn"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">map_hat</span><span class="op">)</span></span>
<span><span class="co">#&gt; EM for Normal Mixture Model</span></span>
<span><span class="co">#&gt; Log-Likelihood = -17266.18</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Univariate normal mixture</span></span>
<span><span class="co">#&gt; Reference scale: 88</span></span>
<span><span class="co">#&gt; Mixture Components:</span></span>
<span><span class="co">#&gt;   comp1        comp2        comp3        comp4       </span></span>
<span><span class="co">#&gt; w   0.48262610   0.41389189   0.06790148   0.03558052</span></span>
<span><span class="co">#&gt; m -46.68513756 -51.27537075 -63.24087734 -53.49794772</span></span>
<span><span class="co">#&gt; s   7.85276132  24.99653345   7.81928574  53.01822291</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">vague_prior</span><span class="op">)</span></span>
<span><span class="co">#&gt; Univariate normal mixture</span></span>
<span><span class="co">#&gt; Reference scale: 88</span></span>
<span><span class="co">#&gt; Mixture Components:</span></span>
<span><span class="co">#&gt;   comp1</span></span>
<span><span class="co">#&gt; w   1  </span></span>
<span><span class="co">#&gt; m -50  </span></span>
<span><span class="co">#&gt; s  88</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="eb-rmap-prior">EB-rMAP Prior<a class="anchor" aria-label="anchor" href="#eb-rmap-prior"></a>
</h2>
<p>We design a current two-arm trial with sample sizes in control and
treatment arms respectively at <span class="math inline">\(n_C=50\)</span> and <span class="math inline">\(n_T=100\)</span>. The general principle is to
evaluate the EB-rMAP weight <span class="math inline">\(w_{EB}\)</span>
within a reasonably wide range of observed mean response <span class="math inline">\(\bar{y}_C\)</span>. In this case study, we set the
range to be -80 to -20, which is even wider than the 95% confidence
interval by the meta analysis, and thus should yield a comprehensive
view of the behavior of <span class="math inline">\(w_{EB}\)</span>
across various scenarios. We first set <span class="math inline">\(\gamma\)</span> at 0.85 and plot.
<em><code>EB_rMAP</code></em> is the function that implements the
EB-rMAP prior method.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">obj1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/EB_rMAP.html">EB_rMAP</a></span><span class="op">(</span><span class="va">map_hat</span>, <span class="va">vague_prior</span>, ppp_cut<span class="op">=</span><span class="fl">0.85</span>, n<span class="op">=</span><span class="fl">100</span>, y_range<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">80</span>, <span class="op">-</span><span class="fl">20</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">obj1</span><span class="op">)</span></span></code></pre></div>
<p><img src="normal_files/figure-html/unnamed-chunk-4-1.png" width="576"></p>
<p>In order to tune the EB-rMAP prior method, it would be more helpful
if we overlay multiple plots of <span class="math inline">\(w_{EB}\)</span> corresponding to different <span class="math inline">\(\gamma\)</span>s on the same plot. This can be
easily done with creating multiple EB-rMAP objects and minimal data
manipulation. For example, we also consider <span class="math inline">\(\gamma=\)</span> 0.7, 0.8 and 0.9. The vertical
dashed line at -49.9 in the plot represents the point estimate of
historical mean response by the meta-analysis.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">obj2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/EB_rMAP.html">EB_rMAP</a></span><span class="op">(</span><span class="va">map_hat</span>, <span class="va">vague_prior</span>, ppp_cut<span class="op">=</span><span class="fl">0.7</span>, n<span class="op">=</span><span class="fl">100</span>, y_range<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">80</span>, <span class="op">-</span><span class="fl">20</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">obj3</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/EB_rMAP.html">EB_rMAP</a></span><span class="op">(</span><span class="va">map_hat</span>, <span class="va">vague_prior</span>, ppp_cut<span class="op">=</span><span class="fl">0.8</span>, n<span class="op">=</span><span class="fl">100</span>, y_range<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">80</span>, <span class="op">-</span><span class="fl">20</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">obj4</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/EB_rMAP.html">EB_rMAP</a></span><span class="op">(</span><span class="va">map_hat</span>, <span class="va">vague_prior</span>, ppp_cut<span class="op">=</span><span class="fl">0.9</span>, n<span class="op">=</span><span class="fl">100</span>, y_range<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">80</span>, <span class="op">-</span><span class="fl">20</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">plotdt1</span> <span class="op">&lt;-</span> <span class="va">obj1</span><span class="op">$</span><span class="va">wdt</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>Gamma<span class="op">=</span><span class="va">obj1</span><span class="op">$</span><span class="va">ppp_cut</span><span class="op">)</span></span>
<span><span class="va">plotdt2</span> <span class="op">&lt;-</span> <span class="va">obj2</span><span class="op">$</span><span class="va">wdt</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>Gamma<span class="op">=</span><span class="va">obj2</span><span class="op">$</span><span class="va">ppp_cut</span><span class="op">)</span></span>
<span><span class="va">plotdt3</span> <span class="op">&lt;-</span> <span class="va">obj3</span><span class="op">$</span><span class="va">wdt</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>Gamma<span class="op">=</span><span class="va">obj3</span><span class="op">$</span><span class="va">ppp_cut</span><span class="op">)</span></span>
<span><span class="va">plotdt4</span> <span class="op">&lt;-</span> <span class="va">obj4</span><span class="op">$</span><span class="va">wdt</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>Gamma<span class="op">=</span><span class="va">obj4</span><span class="op">$</span><span class="va">ppp_cut</span><span class="op">)</span></span>
<span><span class="va">plotdt</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="va">plotdt1</span>, <span class="va">plotdt2</span>, <span class="va">plotdt3</span>, <span class="va">plotdt4</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">plotdt</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">y</span>, y <span class="op">=</span> <span class="va">w_eb</span>, color<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">Gamma</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span>size<span class="op">=</span><span class="fl">1</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_vline</a></span><span class="op">(</span>xintercept<span class="op">=</span><span class="op">-</span><span class="fl">49.9</span>, linetype<span class="op">=</span><span class="st">"dashed"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">xlab</a></span><span class="op">(</span><span class="st">"Observed Mean Response"</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="st">"EB-rMAP Weight"</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_colour_discrete.html" class="external-link">scale_color_discrete</a></span><span class="op">(</span>name<span class="op">=</span><span class="st">"Gamma"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: Using `size` aesthetic for lines was deprecated in ggplot2 3.4.0.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Please use `linewidth` instead.</span></span></code></pre></div>
<p><img src="normal_files/figure-html/unnamed-chunk-6-1.png" width="576"></p>
<p>The generated plot is a useful tool to conduct an initial screen of
<span class="math inline">\(\gamma\)</span> value. For example, a <span class="math inline">\(\gamma\)</span> of 0.7 might be overly aggressive
as there is still considerable amount of borrowing (<span class="math inline">\(w_{EB}=0.54\)</span>) when the observed mean
response <span class="math inline">\(\bar{y}_C = -62\)</span> which is
outside the 95% meta-analysis confidence interval. On the other hand,
one could argue that a <span class="math inline">\(\gamma\)</span> of
0.9 might be conservative. For illustration purposes, we choose <span class="math inline">\(\gamma=0.85\)</span>. In practice, once an initial
set of <span class="math inline">\(\gamma\)</span> values is determined,
their performances should be confirmed via simulations in order to
select the <span class="math inline">\(\gamma\)</span> value that yields
the most robust performance.</p>
</div>
<div class="section level2">
<h2 id="inference-with-observed-current-trial-data">Inference with Observed Current Trial Data<a class="anchor" aria-label="anchor" href="#inference-with-observed-current-trial-data"></a>
</h2>
<p>Bayesian inference based on posterior probabilities can be drawn
after the new trial is concluded and the mean responses <span class="math inline">\(\bar{y}_C\)</span> and <span class="math inline">\(\bar{y}_T\)</span> are observed. Suppose that
<span class="math inline">\(\bar{y}_C\)</span> and <span class="math inline">\(\bar{y}_T\)</span> are -53 and -80, respectively.
The <em><code>wEB</code></em> function returns the EB-rMAP weight <span class="math inline">\(w_{EB}\)</span> corresponding to an observed mean
response <span class="math inline">\(\bar{y}_C\)</span>. This weight
will be used to build the robust MAP prior for the control mean
responses. We draw a sample of size 20,000 from the posterior
distribution of the robust MAP prior.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="op">(</span><span class="va">w</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/wEB.html">wEB</a></span><span class="op">(</span><span class="va">obj1</span>, <span class="op">-</span><span class="fl">53</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 0.11</span></span>
<span></span>
<span><span class="op">(</span><span class="va">rmap_c</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://opensource.nibr.com/RBesT/reference/robustify.html" class="external-link">robustify</a></span><span class="op">(</span><span class="va">map_hat</span>, weight <span class="op">=</span> <span class="va">w</span>, mean <span class="op">=</span> <span class="op">-</span><span class="fl">50</span>, n<span class="op">=</span><span class="fl">1</span>, sigma <span class="op">=</span> <span class="va">sigma</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; Univariate normal mixture</span></span>
<span><span class="co">#&gt; Reference scale: 88</span></span>
<span><span class="co">#&gt; Mixture Components:</span></span>
<span><span class="co">#&gt;   comp1        comp2        comp3        comp4        robust      </span></span>
<span><span class="co">#&gt; w   0.42953723   0.36836378   0.06043232   0.03166666   0.11000000</span></span>
<span><span class="co">#&gt; m -46.68513756 -51.27537075 -63.24087734 -53.49794772 -50.00000000</span></span>
<span><span class="co">#&gt; s   7.85276132  24.99653345   7.81928574  53.01822291  88.00000000</span></span>
<span><span class="op">(</span><span class="va">postmix_rmap_c</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://opensource.nibr.com/RBesT/reference/postmix.html" class="external-link">postmix</a></span><span class="op">(</span><span class="va">rmap_c</span>, n <span class="op">=</span> <span class="fl">50</span>, m <span class="op">=</span> <span class="op">-</span><span class="fl">53</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; Using default prior reference scale 88</span></span>
<span><span class="co">#&gt; Univariate normal mixture</span></span>
<span><span class="co">#&gt; Reference scale: 88</span></span>
<span><span class="co">#&gt; Mixture Components:</span></span>
<span><span class="co">#&gt;   comp1        comp2        comp3        comp4        robust      </span></span>
<span><span class="co">#&gt; w   0.59380430   0.29368965   0.07194565   0.01296934   0.02759105</span></span>
<span><span class="co">#&gt; m -48.48342373 -52.65742172 -60.34236670 -53.02600372 -52.94117647</span></span>
<span><span class="co">#&gt; s   6.64117806  11.14068322   6.62089251  12.11577029  12.32246474</span></span>
<span><span class="va">post_rmap_c</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://opensource.nibr.com/RBesT/reference/mix.html" class="external-link">rmix</a></span><span class="op">(</span>mix <span class="op">=</span> <span class="va">postmix_rmap_c</span>, n <span class="op">=</span> <span class="fl">20000</span><span class="op">)</span></span></code></pre></div>
<p>The treatment arm in the current trial will not be augmented by
historical data. We therefore use the same vague prior in the rMAP prior
for its mean response, and also draw a posterior sample of size
20,000.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">prior_t</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://opensource.nibr.com/RBesT/reference/mixnorm.html" class="external-link">mixnorm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="op">-</span><span class="fl">50</span>, <span class="fl">1</span><span class="op">)</span>, sigma<span class="op">=</span><span class="va">sigma</span>, param<span class="op">=</span><span class="st">"mn"</span><span class="op">)</span></span>
<span><span class="va">postmix_t</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://opensource.nibr.com/RBesT/reference/postmix.html" class="external-link">postmix</a></span><span class="op">(</span><span class="va">prior_t</span>, n <span class="op">=</span> <span class="fl">100</span>, m <span class="op">=</span> <span class="op">-</span><span class="fl">80</span><span class="op">)</span></span>
<span><span class="co">#&gt; Using default prior reference scale 88</span></span>
<span><span class="va">post_t</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://opensource.nibr.com/RBesT/reference/mix.html" class="external-link">rmix</a></span><span class="op">(</span>mix <span class="op">=</span> <span class="va">postmix_t</span>, n <span class="op">=</span> <span class="fl">20000</span><span class="op">)</span></span></code></pre></div>
<p>Finally, the decision rule to claim trial success is <span class="math inline">\(Pr(\theta_T-\theta_C&lt;0|data)&gt;0.95\)</span>.
This can be evaluated by the following codes. Since the posterior
probability 0.987 exceeds the cutoff 0.95, a trial success can be
called.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">diff_sample</span> <span class="op">&lt;-</span> <span class="va">post_t</span> <span class="op">-</span> <span class="va">post_rmap_c</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">diff_sample</span> <span class="op">&lt;</span> <span class="fl">0</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 0.9869</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<p>[1] Weber, S., Li, Y., Seaman III, J. W., Kakizume, T., Schmidli, H.
(2021). Applying Meta-Analytic-Predictive Priors with the R Bayesian
Evidence Synthesis Tools. <em>Journal of Statistical Software</em>, 100,
1-32.</p>
<p>[2] Zhang, H., Shen, Y., Li, J., Ye, H., Chiang, AY. (2023+).
Adaptively Leveraging External Data with Robust
Meta-Analytical-Predictive Prior Using Empirical Bayes.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Hongtao Zhang.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
